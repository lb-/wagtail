{% load wagtailadmin_tags i18n %}

{% if not in_explorer %}
    {# Rendering for the minimap is done with React. #}
    <aside aria-label="{% trans 'Minimap' %}" data-minimap-container></aside>
{% endif %}
{% for panel in side_panels %}
{% comment %} opening one needs to close the others!>!?!? {% endcomment %}
<aside class="form-side form-side--initial"
    id="{{ panel.name }}-side-panel"
    aria-label="{% trans 'Side panels' %}"
    data-controller="w-reveal w-resize"
    data-action="w-side-panel:toggle->w-reveal#toggle w-side-panel:open->w-reveal#open w-side-panel:close->w-reveal#close w-reveal:open@document->w-reveal#open:!self w-side-panel:close->w-reveal#close"
    data-w-resize-active-body-class="side-panel-resizing"
    data-w-reveal-closed-value="true"
    data-w-reveal-ignore-find-value="true"
    data-w-reveal-opened-class="form-side--open"
    data-w-reveal-opened-content-class="side-panel-open"
    {% if not in_explorer %}data-w-resize-storage-value="{{ panel.name }}" data-w-reveal-storage-value="{{ panel.name }}"{% endif %}
>
    <button
        class="form-side__close-button"
        type="button"
        aria-label="{% trans 'Toggle side panel' %}"
        aria-controls="{{ panel.name }}-side-panel-content"
        aria-expanded="false"
        data-action="w-reveal#close"
        data-w-reveal-target="toggle"
    >
        {% icon name="expand-right" %}
    </button>

    <div class="form-side__resize-grip-container">
        {% comment %} need an action filter for ignoring right click {% endcomment %}
        <label class="form-side__resize-grip" data-action="pointerdown->w-resize#start">
            {% comment %}
                By default, the `dir` attribute is inherited from the ancestor
                (i.e. the root `html` element in our case).
                On Chrome and Firefox, moving the slider with left-right arrow keys
                is correctly reversed when dir="rtl". On Safari, this isn't the case.
                So, we explicitly set the `dir` attribute to "ltr" on the input and handle the correct
                direction in the JS code based on the `dir` attribute of the root `html`.
            {% endcomment %}
            <input type="range" step="10" dir="ltr" class="form-side__width-input" name="wagtail-side-panel-width" data-w-resize-target="width" data-action="w-resize#adjust" />
            <span class="w-sr-only">{% trans 'Side panel width' %}</span>
            <div class="form-side__resize-grip-icon"></div>
        </label>
    </div>

    <div class="form-side__panel" id="{{ panel.name }}-side-panel-content" data-w-reveal-target="content" hidden>
        <h2 id="side-panel-{{ panel.name }}-title" class="w-sr-only" data-w-reveal-target="heading">{{ panel.title }}</h2>
        {% component panel %}
    </div>
</aside>
{% endfor %}
